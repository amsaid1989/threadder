(this["webpackJsonpthreadder-frontend"]=this["webpackJsonpthreadder-frontend"]||[]).push([[0],{142:function(e,t,n){},164:function(e,t,n){},165:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(11),c=n.n(i),o=n(32),s=n.n(o),l=n(34),u=n(45),d=n(14),f=n(63),h=n(202),m=n(214),g=n(9),b=n.n(g),j=n(95),p=n.n(j),x=n(105),O={main:"#283845",light:"#395164",dark:"#22303c",contrastText:"#ffffff",contrastText2:"#e5e5e5"},v={paper:O.light,default:"#202c39"},w=Object(x.a)({palette:{primary:O,secondary:{main:"#ffc107",light:"#ffd147",dark:"#c97d02",hover:"#ffa042",inactive:"#432a01",contrastText:"#14213d",inactiveText:"#111111"},background:v},spacing:4,shape:{borderRadius:2}}),y=n(215),k=n(210),I=n(209),C=n(219),T=n(206),S=n(207),N=n(168),E=n(38),F=n(203),L=n(3),H=Object(h.a)((function(e){return{styledButton:{"&:disabled":{color:e.palette.secondary.inactiveText,backgroundColor:e.palette.secondary.inactive},"&:hover":{backgroundColor:e.palette.secondary.hover}}}}));function A(e){var t=H(),n=b()(e.className,t.styledButton);return Object(L.jsx)(F.a,Object(E.a)(Object(E.a)({},e),{},{className:n}))}var D=n(216),z=n(205),B=n(222),P=n(220),R=Object(h.a)((function(e){return{menuList:{border:"solid 1px ".concat(e.palette.primary.dark)}}}));function W(e){var t={paper:R().menuList};return Object(L.jsx)(P.a,Object(E.a)({classes:t},e))}var G=n(223),U=Object(h.a)((function(e){return{menuList:{border:"solid 1px ".concat(e.palette.primary.dark)},menuItem:{color:e.palette.primary.contrastText,"&:hover":{color:e.palette.secondary.contrastText,backgroundColor:e.palette.secondary.main}}}}));function M(e){var t=U(),n=Object(a.useState)(null),r=Object(d.a)(n,2),i=r[0],c=r[1],o=function(){c(null)};return Object(L.jsxs)(D.a,{children:[Object(L.jsx)(z.a,{size:"small",onClick:function(e){c(e.currentTarget)},children:Object(L.jsx)(B.a,{src:e.user.profileImage,alt:"".concat(e.user.name," profile picture")})}),Object(L.jsxs)(W,{id:"account-settings-menu",getContentAnchorEl:null,anchorEl:i,anchorReference:"anchorEl",anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},open:Boolean(i),onClose:o,autoFocus:!1,children:[Object(L.jsx)(G.a,{className:t.menuItem,onClick:function(){o();var t=e.user.screenName;window.open("https://twitter.com/".concat(t),"_blank")},children:"Go to Twitter"}),Object(L.jsx)(G.a,{className:t.menuItem,onClick:function(){o(),e.logout()},children:"Log out"})]})]})}var _=Object(h.a)((function(e){return{toolbar:{height:"1em",padding:"1em 1.5em"},title:{flexGrow:1}}}));function q(e){var t=_(),n=Object(L.jsx)(A,{variant:"contained",color:"secondary",onClick:e.login,children:"Log in"});return Object(L.jsx)(T.a,{position:"relative",children:Object(L.jsxs)(S.a,{className:t.toolbar,children:[Object(L.jsx)(N.a,{variant:"h5",className:t.title,children:"Threadder"}),e.loggedIn?Object(L.jsx)(M,{user:e.user,logout:e.logout}):n]})})}var V=Object(h.a)((function(e){return{toolbarButton:{marginRight:"0.45em",color:e.palette.secondary.dark,"&:hover":{color:e.palette.secondary.main}}}}));function J(e){var t=V(),n=b()(e.className,t.toolbarButton);return Object(L.jsx)(z.a,Object(E.a)(Object(E.a)({},e),{},{className:n,children:e.children}))}var Y=n(97),Z=n.n(Y),$=n(99),K=n.n($),Q=n(98),X=n.n(Q),ee=n(208),te=n(96),ne=n(104),ae=(n(141),n(142),Object(h.a)((function(e){return{root:{padding:0,marginTop:"0.5em"}}})));function re(e){var t=ae(),n=Object(a.useState)(!1),r=Object(d.a)(n,2),i=r[0],c=r[1];return Object(L.jsxs)("div",{className:t.root,children:[Object(L.jsx)(C.a,{smDown:!0,children:Object(L.jsx)(ee.a,{onClickAway:function(){c(!1)},children:Object(L.jsxs)("span",{style:{position:"relative"},children:[i&&Object(L.jsx)(ne.a,{set:"twitter",data:te,title:"",emoji:"",showPreview:!1,perLine:8,onSelect:e.pickEmojiHandler}),Object(L.jsx)(J,{size:"small",onClick:function(){c((function(e){return!e}))},title:"Emoji",children:Object(L.jsx)(Z.a,{})})]})})}),Object(L.jsx)(J,{size:"small",onClick:e.splitTweetHandler,title:"Split",children:Object(L.jsx)(X.a,{})}),Object(L.jsx)(J,{size:"small",onClick:e.clearTweetHandler,title:"Clear",children:Object(L.jsx)(K.a,{})})]})}var ie=Object(h.a)((function(e){return{root:{flexFlow:"column nowrap"},fullHeight:{height:"100%"},containerWithShadow:{boxShadow:e.shadows[4]},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},textareaContainer:{display:"flex",flexFlow:"column nowrap",padding:"1.5em",paddingBottom:"0.55em",backgroundColor:e.palette.primary.main},threadTextarea:{fontFamily:"inherit",fontSize:"inherit",resize:"none",width:"100%",padding:"0.5em 0.75em",color:e.palette.primary.contrastText,backgroundColor:e.palette.primary.main,border:0,boxShadow:"inset 0px 0px 5px 0px rgba(0, 0, 0, 0.4)","&:focus":{border:0,outline:0}},statsContainer:{padding:"1em 1.5em",display:"flex",flexFlow:"row nowrap",justifyContent:"space-between",backgroundColor:e.palette.primary.dark},statsText:{color:e.palette.primary.contrastText2},emojiPicker:{position:"absolute"}}})),ce=r.a.forwardRef((function(e,t){var n=ie();return Object(L.jsxs)(I.a,{container:!0,spacing:2,className:b()(n.root,n.fullHeight),children:[Object(L.jsx)(I.a,{item:!0,xs:12,className:b()(n.expandingFlexItem,n.fullHeight),children:Object(L.jsxs)(k.a,{className:b()(n.textareaContainer,n.fullHeight,n.containerWithShadow),children:[Object(L.jsx)("textarea",{className:b()(n.threadTextarea,n.fullHeight),onChange:e.handleTweetInput,onSelect:e.handleCursorPositionChange,placeholder:"Type your tweet here...",value:e.tweetText,ref:t}),Object(L.jsx)(re,{pickEmojiHandler:e.pickEmojiHandler,splitTweetHandler:e.splitTweetHandler,clearTweetHandler:e.clearTweetHandler})]})}),Object(L.jsx)(I.a,{item:!0,xs:12,className:n.fixedSizeFlexItem,children:Object(L.jsxs)(k.a,{className:b()(n.statsContainer,n.containerWithShadow),children:[Object(L.jsx)(N.a,{variant:"body2",className:n.statsText,children:"Characters: ".concat(e.tweetText.length)}),Object(L.jsx)(N.a,{variant:"body2",className:n.statsText,children:"Tweets: ".concat(e.thread.length)})]})}),Object(L.jsx)(C.a,{mdUp:!0,children:Object(L.jsx)(I.a,{item:!0,xs:12,className:n.fixedSizeFlexItem,children:Object(L.jsx)(A,{variant:"contained",color:"secondary",fullWidth:!0,onClick:e.viewThreadHandler,children:"View thread"})})})]})})),oe=n(39),se=n(101),le=n.n(se),ue=n(100);n.n(ue).a.config();var de=280,fe="https://threadder-app.herokuapp.com/",he="Untitled User",me=Object(h.a)((function(e){return{root:{width:"100%",marginTop:"0.4em",display:"flex",flexFlow:"row nowrap",gap:0,justifyContent:"space-between",alignItems:"center"},imageButton:{margin:0,padding:0,position:"relative",left:"-0.1875rem"},resetFont:{fontFamily:"inherit",fontSize:"inherit"},tweetLength:{margin:0,width:"100%",textAlign:"right",color:e.palette.secondary.main}}}));function ge(e){var t=me(),n=[".png",".jpg",".jpeg",".gif",".webp"],a=function(e){return e.length>4||e.some((function(e){return"image/gif"===e.type}))&&e.length>1},r=function(e){var t=n.map((function(e){return"image/".concat(e.slice(1))}));return e.every((function(e){return t.some((function(t){return e.type===t}))}))},i=function(e){return e.size<5e6||"image/gif"===e.type&&e.size<15e6};return Object(L.jsxs)(I.a,{className:t.root,children:[Object(L.jsx)(I.a,{item:!0,children:Object(L.jsxs)(J,{className:t.imageButton,size:"small",title:"Add image",disabled:e.addDisabled,onClick:function(e){e.target.parentElement.parentElement.querySelector("input[type='file']").click()},children:[Object(L.jsx)(le.a,{}),Object(L.jsx)("input",{type:"file",accept:n.join(","),multiple:!0,hidden:!0,onChange:function(t){var c=t.target.files;if(0!==c.length){var o=Array.from(c);a(o)?e.setAlertData("error","A maximum of 1 GIF or 4 images can be added"):r(o)?o.every((function(e){return i(e)}))?(e.addImagesHandler(o),t.target.value=""):e.setAlertData("error","You can only upload images that are smaller than 5 MB or GIFs smaller than 15 MB"):e.setAlertData("error","Only the following file types are supported: ".concat(n.join(", ")))}}})]})}),Object(L.jsx)(I.a,{item:!0,children:Object(L.jsx)("p",{className:b()(t.resetFont,t.tweetLength),children:"".concat(e.length,"/").concat(de)})})]})}var be,je=n(102),pe=n.n(je),xe=Object(h.a)((function(e){return{root:{position:"relative",width:"100%",minHeight:"100%",maxHeight:"100%"},deleteButton:{padding:0,margin:0,position:"absolute",right:"6px",top:"6px",display:"flex",justifyContent:"center",alignItems:"center"},iconBackground:{position:"absolute",minWidth:"65%",maxWidth:"65%",minHeight:"65%",maxHeight:"65%",backgroundColor:"black",borderRadius:"1em"},buttonIcon:{zIndex:900,scale:1.2},image:{width:"100%",height:"100%",objectFit:"cover"}}}));function Oe(e){var t=xe();return Object(L.jsxs)("div",{className:t.root,style:{gridColumn:e.gridColumn,gridRow:e.gridRow},children:[Object(L.jsxs)(J,{size:"small",className:t.deleteButton,onClick:function(){return e.deleteImageHandler(e.imageIndex)},children:[Object(L.jsx)("span",{className:t.iconBackground}),Object(L.jsx)(pe.a,{className:t.buttonIcon})]}),Object(L.jsx)("img",{src:e.imageSource,alt:e.altText,className:t.image,onLoad:function(){URL.revokeObjectURL(e.imageSource)}})]})}function ve(e){return e%2===0}var we=!1;function ye(){return we}function ke(){return new Promise((function(e,t){window.indexedDB||t("Your browser doesn't support IndexedDB. Some features may not work properly.");var n=window.indexedDB.open("threadderDB",1);n.addEventListener("error",(function(e){var n=e.target.error;t("".concat(n.name,": ").concat(n.message))})),n.addEventListener("blocked",(function(){t("Upgrading the database failed. Please close all other tabs with this site open.")})),n.addEventListener("upgradeneeded",(function(e){!function(e){t=e.createObjectStore("images",{keyPath:"tweetIndex"}),n=[{name:"tweetIndex",keyPath:"tweetIndex",params:{unique:!0}}],n.forEach((function(e){t.createIndex(null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.keyPath,null===e||void 0===e?void 0:e.params)}));var t,n}(e.target.result)})),n.addEventListener("success",(function(t){be=t.target.result,we=!0,be.addEventListener("close",(function(){we=!1})),e("Connected")}))}))}function Ie(e,t,n){return new Promise((function(a,r){be&&be instanceof IDBDatabase?function(e){var t=e.map(function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:if(!((n=e.sent)instanceof ArrayBuffer)){e.next=5;break}return e.abrupt("return",{name:t.name,type:t.type,buffer:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return Promise.all(t)}(t).then((function(t){var i=be.transaction(["images"],"readwrite"),c=i.objectStore("images"),o={tweetIndex:e,buffers:t},s=c[n](o),l=function(){r("Failed to save images to database")};i.addEventListener("abort",(function(){r("Adding images to the database was aborted")})),i.addEventListener("error",l),s.addEventListener("success",(function(){a("All done!")})),s.addEventListener("error",l)})).catch((function(){r("Images are not formatted properly for the database")})):r("Can't save any images because the database isn't open")}))}function Ce(e,t){return Ie(e,t,"add")}function Te(e,t){return Ie(e,t,"put")}function Se(e,t){return new Promise((function(n,a){if(be&&be instanceof IDBDatabase){var r=be.transaction(["images"],"readwrite"),i=r.objectStore("images")[t](e),c=function(){a("Failed to save images to database")};r.addEventListener("abort",(function(){a("Adding images to the database was aborted")})),r.addEventListener("error",c),i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",c)}else a("Can't save any images because the database isn't open")}))}function Ne(e){return Se(e,"delete")}function Ee(e){return new Promise((function(t){Se(e,"get").then((function(e){t(!!e)})).catch((function(){t(!1)}))}))}function Fe(e){return e.map((function(e){return new File([e.buffer],e.name,{type:e.type})}))}var Le=Object(h.a)((function(e){return{root:{marginBottom:"1em",flexFlow:"row nowrap","&:last-child":{marginBottom:0}},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},verticalGrid:{display:"flex",flexFlow:"column nowrap"},centerVerticalGridItems:{alignItems:"center"},threadLineContainer:{padding:0},threadLine:{width:"2px",height:"calc(100% + 1.5em)",backgroundColor:e.palette.background.default},tweetContainer:{marginLeft:"1em"},resetFont:{fontFamily:"inherit",fontSize:"inherit"},defaultTextColor:{color:e.palette.primary.contrastText},userName:{fontWeight:"bold"},userHandle:{color:e.palette.primary.contrastText2,marginLeft:"0.5em"},tweetText:{padding:0,margin:0,marginTop:"0.25em",whiteSpace:"pre-wrap",overflowWrap:"break-word"},imageGallery:{width:"100%",height:"16em",minHeight:"16em",maxHeight:"16em",marginTop:"0.4em",borderRadius:"0.5em",display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr 1fr",gridGap:"0.25em"},hiddenOverflow:{overflow:"hidden"}}}));function He(e){var t=Le(),n=e.tweetIndex,r=e.setAlertData,i=Object(a.useState)([]),c=Object(d.a)(i,2),o=c[0],l=c[1],f=Object(a.useState)(!0),h=Object(d.a)(f,2),m=h[0],g=h[1],j=Object(a.useState)(!1),p=Object(d.a)(j,2),x=p[0],O=p[1],v=function(e){var t=[].concat(Object(oe.a)(o.slice(0,e)),Object(oe.a)(o.slice(e+1)));l(t)},w=o.map((function(e,t,n){var a,r,i=(a=t,r=n.length,[ve(a)?1:2,ve(a)&&r===a+1||a%2!==0?3:2]),c=Object(d.a)(i,2),o=c[0],s=c[1],l=function(e,t){return[e<2?1:2,e<2&&t<3||e>=2?3:2]}(t,n.length),u=Object(d.a)(l,2),f=u[0],h=u[1],m=e+t+o+s+f+h,g=URL.createObjectURL(e);return Object(L.jsx)(Oe,{imageSource:g,altText:"",gridColumn:"".concat(o," / ").concat(s),gridRow:"".concat(f," / ").concat(h),imageIndex:t,deleteImageHandler:v},m)}));return Object(a.useEffect)((function(){var e,t;m&&(e=setInterval((function(){ye()&&(clearInterval(e),function(e){return new Promise((function(t){Se(e,"get").then((function(e){t(e?Fe(e.buffers):[])})).catch((function(){t([])}))}))}(n).then((function(e){l(e)})),g(!1))}),20),t||(t=setTimeout((function(){clearInterval(e)}),1e4)))}),[m,n]),Object(a.useEffect)((function(){var e=4===o.length||1===o.length&&"image/gif"===o[0].type;O(e)}),[o]),Object(a.useEffect)((function(){Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ye()){e.next=5;break}return e.next=3,Ee(n);case 3:e.sent?o.length>0?Te(n,o).catch((function(e){r("error",e)})):Ne(n).catch((function(e){r("error",e)})):o.length>0&&Ce(n,o).catch((function(e){r("error",e)}));case 5:case"end":return e.stop()}}),e)})))()}),[n,r,o]),Object(L.jsxs)(I.a,{container:!0,className:t.root,children:[Object(L.jsxs)(I.a,{container:!0,className:b()(t.fixedSizeFlexItem,t.verticalGrid,t.centerVerticalGridItems),children:[Object(L.jsx)(I.a,{item:!0,children:Object(L.jsx)(B.a,{src:e.user.profileImage,alt:"".concat(e.user.name," profile picture")})}),e.threadLine&&Object(L.jsx)(I.a,{item:!0,className:b()(t.expandingFlexItem,t.threadLineContainer),children:Object(L.jsx)("div",{className:t.threadLine})})]}),Object(L.jsxs)(I.a,{container:!0,className:b()(t.expandingFlexItem,t.verticalGrid,t.tweetContainer,t.hiddenOverflow),children:[Object(L.jsxs)(I.a,{item:!0,children:[Object(L.jsx)("span",{className:b()(t.resetFont,t.defaultTextColor,t.userName),children:e.user.name}),Object(L.jsx)("span",{className:b()(t.resetFont,t.userHandle),children:"@".concat(e.user.screenName)})]}),Object(L.jsx)(I.a,{item:!0,children:Object(L.jsx)("p",{className:b()(t.resetFont,t.defaultTextColor,t.tweetText),children:e.text})}),Object(L.jsx)(C.a,{xsUp:0===o.length,children:Object(L.jsx)(I.a,{item:!0,className:b()(t.imageGallery,t.hiddenOverflow),children:w})}),Object(L.jsx)(I.a,{item:!0,children:Object(L.jsx)(ge,{length:e.text.length,addDisabled:x,setAlertData:e.setAlertData,addImagesHandler:function(e){var t=[].concat(Object(oe.a)(o),Object(oe.a)(e));l(t)}})})]})]})}var Ae=Object(h.a)((function(e){return{root:{flexFlow:"column nowrap"},fullHeight:{height:"100%"},containerWithShadow:{boxShadow:e.shadows[4]},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},autoOverflow:{overflow:"auto"},hiddenOverflow:{overflow:"hidden"},tweetsContainer:{padding:"1.5em",backgroundColor:e.palette.primary.main},buttonRowContainer:{display:"flex",flexFlow:"row nowrap",justifyContent:"space-between",gap:"1em",margin:0,padding:0}}}));function De(e){var t=Ae(),n=e.thread.map((function(t,n,a){return Object(L.jsx)(He,{tweetIndex:n,user:e.user,text:t,threadLine:n+1<a.length,setAlertData:e.setAlertData},n)}));return Object(L.jsxs)(I.a,{container:!0,spacing:2,className:b()(t.root,t.fullHeight,t.hiddenOverflow),children:[Object(L.jsx)(I.a,{item:!0,xs:12,className:b()(t.expandingFlexItem,t.fullHeight,t.hiddenOverflow),children:Object(L.jsx)(k.a,{className:b()(t.tweetsContainer,t.fullHeight,t.containerWithShadow,t.autoOverflow),children:n})}),Object(L.jsx)(I.a,{item:!0,xs:12,className:t.fixedSizeFlexItem,children:Object(L.jsxs)(k.a,{className:b()(t.buttonRowContainer,t.fullHeight),children:[Object(L.jsx)(C.a,{mdUp:!0,children:Object(L.jsx)(A,{variant:"contained",color:"secondary",fullWidth:!0,onClick:e.editThreadHandler,children:"Edit thread"})}),Object(L.jsx)(A,{variant:"contained",color:"secondary",onClick:e.publishHandler,disabled:!n.length>0,fullWidth:!0,children:"Publish thread"})]})})]})}var ze=n(221),Be=n(211),Pe=n(212),Re=Object(h.a)((function(e){return{dialogText:{color:e.palette.primary.contrastText,textAlign:"center"}}}));function We(e){var t=Re();return Object(L.jsx)(ze.a,{open:e.open,children:Object(L.jsx)(Be.a,{children:Object(L.jsx)(Pe.a,{className:t.dialogText,children:e.msg})})})}var Ge=n(213),Ue=n(217),Me=Object(h.a)((function(e){return{root:{position:"absolute",width:"50%",margin:0,zIndex:1e4,left:"25%",top:0}}}));function _e(e){var t=Me();return Object(L.jsx)(Ge.a,{in:e.visible,className:t.root,children:Object(L.jsx)(Ue.a,{severity:e.severity,children:e.msg})})}function qe(e){return e.replace(/^[ \t]*/,"").replace(/[ \t]*$/,"")}function Ve(e){return e.split(/(\n)/).filter((function(e,t,n){return"\n"!==e||"\n"===e&&"\n"!==n[t]}))}function Je(e){return e.split(/((?<!\svs?)(?<=\s\w+[a-zA-Z]+)\.(?=\s*[a-zA-Z]+\w*)|(?<=\d+[\s./-]\d+|\s\d+)\.(?=\s*\W*[a-zA-Z]+\w*\W*)|\.$)/g).map((function(e,t,n){return"."===n[t+1]?"".concat(e,"."):"."===e?"":e})).filter((function(e){return""!==e})).map((function(e){return qe(e)}))}function Ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";if(0===e.length)return[];for(var n=[],a=0;a<e.length;a++)if(0!==a){var r=n.length-1,i=n[r],c=e[a];i.length<=70||i.length+c.length<=de?(i+=c.startsWith("\n")?c:"".concat(t).concat(c),n[r]=i):n.push(e[a])}else n.push(e[a]);return n}function Ze(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];if(0!==n){var r=t.length-1,i=Ke(t[r]);i.length+a.length+1<=de?t[r]="".concat(i," ").concat(a):t.push(a)}else t.push(a)}return t}function $e(e){if(e.length<=de)return e;for(var t=Math.ceil(e.length/277),n=[],a=0;a<t;a++){var r=277*a,i=277*(a+1),c=e.slice(r,i)+"...";n.push(c)}return n}function Ke(e){return"..."===e.slice(e.length-3)?e.slice(0,e.length-3):e}function Qe(e){var t=e.trim().split("(---)").map((function(e){return e.trim()})).filter((function(e){return""!==e}));if(Xe(t))return t;var n=t.map((function(e){return e.length<=de?e:function(e){var t=Ye(Ve(e),"\n");return t.every((function(e){return e.length<=de}))?t:Ye(t.map((function(e){return e.length<=de?e:Je(e)})).flat().map((function(e){return e.trim()})))}(e)})).flat().map((function(e){return e.trim()}));return Xe(n)?n:Ze(n.map((function(e){return e.length<=de?e:function(e){if(e.length<=de)return e;var t,n=e.split(" ").filter((function(e){return 0!==e.length})),a="",r=[],i=Object(l.a)(n);try{for(i.s();!(t=i.n()).done;){var c=t.value.trim();c.length>de?(a.length>0&&(r.push("".concat(a,"...")),a=""),r=[].concat(Object(oe.a)(r),Object(oe.a)($e(c)))):0===a.length?a+=c:a.length+c.length+1<277?a+=" ".concat(c):(r.push("".concat(a,"...")),a=c)}}catch(s){i.e(s)}finally{i.f()}a.length>0&&r.push(a);var o=r.length-1;return r[o]=Ke(r[o]),r}(e)})).flat().map((function(e){return e.trim()}))).flat().map((function(e){return e.trim()}))}function Xe(e){return e.every((function(e){return e.length<=de}))}function et(e){return null!==e&&(t=e,Object.entries(t).length>0)&&function(e,t){var n,a=Object.keys(e),r=Object(l.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!a.includes(i))return!1}}catch(c){r.e(c)}finally{r.f()}return!0}(e,["name","screenName","profileImage"])&&e.name!==he;var t}var tt=n(103),nt=n.n(tt);function at(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return nt()({url:e,method:t,withCredentials:!0,baseURL:fe,data:n||{}})}function rt(e){return new Promise((function(t,n){var a=e.map((function(e){return function(e){var t=new FormData;return t.append("mediaFile",e),at("/upload_media","post",t)}(e)}));Promise.all(a).then((function(e){var n=e.map((function(e){return e.data.media_id}));t(n)})).catch((function(e){n(e)}))}))}function it(e){return at("/publish_thread","post",{tweets:e})}function ct(e){return"local"===e?localStorage:"session"===e?sessionStorage:void 0}function ot(e,t,n){var a=ct(e);a&&a.setItem(t,JSON.stringify(n))}function st(e,t){var n=ct(e);if(n)return JSON.parse(n.getItem(t))}var lt=Object(h.a)((function(e){return{root:{height:"100vh",maxHeight:"100vh"},gridContainer:{flexFlow:"column nowrap",height:"100%"},appHeader:{flex:0},appView:Object(f.a)({flex:1},e.breakpoints.up("md"),{display:"flex",flexFlow:"row nowrap",gap:e.spacing(1.5)}),mainArea:{height:"100%"},hiddenOverflow:{overflow:"hidden"}}}));function ut(e){var t=lt(),n={name:he,screenName:"untitled_user",profileImage:""},r=Object(a.useState)(!1),i=Object(d.a)(r,2),c=i[0],o=i[1],f=Object(a.useState)(!1),h=Object(d.a)(f,2),g=h[0],j=h[1],x=Object(a.useState)("error"),O=Object(d.a)(x,2),v=O[0],T=O[1],S=Object(a.useState)(""),N=Object(d.a)(S,2),E=N[0],F=N[1],H=Object(a.useState)(!1),A=Object(d.a)(H,2),D=A[0],z=A[1],B=Object(a.useState)("This is an empty dialog"),P=Object(d.a)(B,2),R=P[0],W=P[1],G=Object(a.useState)(st("session","loggedIn")||!1),U=Object(d.a)(G,2),M=U[0],_=U[1],V=Object(a.useState)(st("session","user")||n),J=Object(d.a)(V,2),Y=J[0],Z=J[1],$=Object(a.useState)(st("session","tweetText")||""),K=Object(d.a)($,2),Q=K[0],X=K[1],ee=Object(a.useState)({start:Q.length,end:Q.length}),te=Object(d.a)(ee,2),ne=te[0],ae=te[1],re=Object(a.useState)([]),ie=Object(d.a)(re,2),oe=ie[0],se=ie[1],le=Object(a.useState)(!0),ue=Object(d.a)(le,2),de=ue[0],fe=ue[1],me=Object(a.createRef)(),ge=function(e){var t=function(e,t,n){return[e.slice(0,t.start)+n+e.slice(t.end),t.start+n.length]}(Q,ne,e),n=Object(d.a)(t,2),a=n[0],r=n[1];ae({start:r,end:r}),X(a)},je=function(){fe(!de)},pe=Object(a.useCallback)((function(e,t){j(!0),T(e),F(t)}),[]),xe=function(){ve("Please wait while we try to log you into your account"),at("/request_token","get").then((function(e){document.location.href=e.data.redirect})).catch((function(e){console.log(e),pe("error","string"===typeof e?e:"Login failed")})).finally(we)},Oe=Object(a.useCallback)(Object(u.a)(s.a.mark((function e(){var t,n,a,r,i,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ve("Hold tight while we publish your thread"),t=oe.map((function(e){return{text:e,media:[]}})),e.next=4,new Promise((function(e,t){if(be&&be instanceof IDBDatabase){var n=be.transaction(["images"],"readonly"),a=n.objectStore("images").getAll(),r=function(){t("Failed to retrieve images from the database")};n.addEventListener("error",r),n.addEventListener("abort",(function(){t("Retrieving the images from the database was aborted")})),a.addEventListener("error",r),a.addEventListener("success",(function(t){var n,a=[],r=Object(l.a)(t.target.result);try{for(r.s();!(n=r.n()).done;){var i=n.value,c=i.buffers;delete i.buffers,i.files=Fe(c),a.push(i)}}catch(o){r.e(o)}finally{r.f()}e(a)}))}else t("Database is not connected")}));case 4:if(!((n=e.sent)instanceof Array&&n.length>0)){e.next=31;break}a=Object(l.a)(n),e.prev=7,a.s();case 9:if((r=a.n()).done){e.next=23;break}return i=r.value,c=Number(i.tweetIndex),e.next=14,rt(i.files);case 14:if(!((o=e.sent)instanceof Array)){e.next=19;break}t[c].media=o,e.next=21;break;case 19:return pe("error","Thread publishing was cancelled because publishing the images failed"),e.abrupt("return");case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(7),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:it(t).then((function(){pe("success","Thread published successfully"),X("")})).catch((function(e){console.log(e),pe("error","string"===typeof e?e:"Failed to publish your thread")})).finally(we);case 32:case"end":return e.stop()}}),e,null,[[7,25,28,31]])}))),[oe,pe]),ve=function(e){W(e),z(!0)},we=function(){z(!1)};return Object(a.useEffect)((function(){c||ke().then((function(){o(!0)})).catch((function(e){pe("error",e)}))}),[c,pe]),Object(a.useEffect)((function(){st("session","loginSuccessMessage")?(ot("session","loginSuccessMessage",!1),pe("success","You are now logged in")):st("session","loginFailMessage")&&(ot("session","loginFailMessage",!1),pe("error","Login failed"))}),[pe]),Object(a.useEffect)((function(){if(""!==document.location.search){var e=p.a.parse(document.location.search);document.location.search="",et(e)?(_(!0),Z(e),ot("session","loginSuccessMessage",!0)):ot("session","loginFailMessage",!0)}}),[]),Object(a.useEffect)((function(){""===document.location.search&&oe.length>0&&st("session","publishAfterLogin")&&(ot("session","publishAfterLogin",!1),Oe())}),[oe,Oe]),Object(a.useEffect)((function(){me.current&&(me.current.selectionStart=ne.start,me.current.selectionEnd=ne.end)})),Object(a.useEffect)((function(){me.current&&me.current.focus()}),[me]),Object(a.useEffect)((function(){ot("session","loggedIn",M)}),[M]),Object(a.useEffect)((function(){ot("session","user",Y)}),[Y]),Object(a.useEffect)((function(){var e,t;e=setInterval((function(){ye()&&(clearInterval(e),0===Q.length&&function(){if(be&&be instanceof IDBDatabase){var e=be.transaction(["images"],"readwrite"),t=e.objectStore("images").clear();e.addEventListener("error",(function(){return"Clear images transaction failed"})),t.addEventListener("error",(function(){return"Clear images request failed"}))}}())}),20),t||(t=setTimeout((function(){clearInterval(e)}),1e4))}),[Q]),Object(a.useEffect)((function(){0===Q.length?se([]):se(Qe(Q)),ot("session","tweetText",Q)}),[Q]),Object(a.useEffect)((function(){var e;if(g)return e&&clearTimeout(e),e=setTimeout((function(){j(!1)}),4e3),function(){return clearTimeout(e)}}),[g]),Object(L.jsx)(m.a,{theme:w,children:Object(L.jsxs)(y.a,{children:[Object(L.jsx)(_e,{visible:g,severity:v,msg:E}),Object(L.jsx)(We,{open:D,msg:R}),Object(L.jsx)(k.a,{className:t.root,children:Object(L.jsxs)(I.a,{container:!0,spacing:3,className:t.gridContainer,children:[Object(L.jsx)(I.a,{item:!0,xs:12,className:t.appHeader,children:Object(L.jsx)(q,{user:Y,loggedIn:M,login:xe,logout:function(){at("/logout","get").then((function(){pe("success","You are now logged out"),_(!1),Z(n)})).catch((function(e){console.log(e),pe("error","string"===typeof e?e:"Logout failed")}))}})}),Object(L.jsxs)(I.a,{item:!0,xs:12,className:b()(t.appView,t.hiddenOverflow),children:[Object(L.jsx)(C.a,{smDown:!de,children:Object(L.jsx)(I.a,{item:!0,xs:12,md:7,className:b()(t.mainArea,t.hiddenOverflow),children:Object(L.jsx)(ce,{tweetText:Q,handleTweetInput:function(e){var t=e.target.value;X(t),ae({start:e.target.selectionStart,end:e.target.selectionEnd})},handleCursorPositionChange:function(e){var t=e.target.selectionStart,n=e.target.selectionEnd;ae({start:t,end:n})},pickEmojiHandler:function(e){ge(e.native)},splitTweetHandler:function(){ge("\n(---)\n")},clearTweetHandler:function(){X("")},thread:oe,viewThreadHandler:je,ref:me})})}),Object(L.jsx)(C.a,{smDown:de,children:Object(L.jsx)(I.a,{item:!0,xs:12,md:5,className:b()(t.mainArea,t.hiddenOverflow),children:Object(L.jsx)(De,{user:Y,thread:oe,editThreadHandler:je,publishHandler:function(){M?Oe():(ot("session","publishAfterLogin",!0),xe())},setAlertData:pe})})})]})]})})]})})}n(164);c.a.render(Object(L.jsx)(r.a.StrictMode,{children:Object(L.jsx)(ut,{})}),document.querySelector("#root"))}},[[165,1,2]]]);
//# sourceMappingURL=main.e882d981.chunk.js.map