(this["webpackJsonpthreadder-frontend"]=this["webpackJsonpthreadder-frontend"]||[]).push([[0],{143:function(e,t,n){},165:function(e,t,n){},166:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(11),o=n.n(i),c=n(33),s=n.n(c),l=n(27),u=n(45),d=n(14),f=n(63),m=n(203),h=n(215),g=n(9),b=n.n(g),p=n(95),j=n.n(p),x=n(106),v={main:"#283845",light:"#395164",dark:"#22303c",contrastText:"#ffffff",contrastText2:"#e5e5e5"},w={paper:v.light,default:"#202c39"},O=Object(x.a)({palette:{primary:v,secondary:{main:"#ffc107",light:"#ffd147",dark:"#c97d02",hover:"#ffa042",inactive:"#432a01",contrastText:"#14213d",inactiveText:"#111111"},background:w},spacing:4,shape:{borderRadius:2}}),y=n(216),k=n(211),I=n(210),T=n(220),C=n(207),S=n(208),N=n(169),E=n(38),L=n(204),F=n(3),H=Object(m.a)((function(e){return{styledButton:{"&:disabled":{color:e.palette.secondary.inactiveText,backgroundColor:e.palette.secondary.inactive},"&:hover":{backgroundColor:e.palette.secondary.hover}}}}));function A(e){var t=H(),n=b()(e.className,t.styledButton);return Object(F.jsx)(L.a,Object(E.a)(Object(E.a)({},e),{},{className:n}))}var z=n(217),D=n(206),B=n(223),W=n(221),P=Object(m.a)((function(e){return{menuList:{border:"solid 1px ".concat(e.palette.primary.dark)}}}));function R(e){var t={paper:P().menuList};return Object(F.jsx)(W.a,Object(E.a)({classes:t},e))}var U=n(224),G=Object(m.a)((function(e){return{menuList:{border:"solid 1px ".concat(e.palette.primary.dark)},menuItem:{color:e.palette.primary.contrastText,"&:hover":{color:e.palette.secondary.contrastText,backgroundColor:e.palette.secondary.main}}}}));function M(e){var t=G(),n=Object(a.useState)(null),r=Object(d.a)(n,2),i=r[0],o=r[1],c=function(){o(null)};return Object(F.jsxs)(z.a,{children:[Object(F.jsx)(D.a,{size:"small",onClick:function(e){o(e.currentTarget)},children:Object(F.jsx)(B.a,{src:e.user.profileImage,alt:"".concat(e.user.name," profile picture")})}),Object(F.jsxs)(R,{id:"account-settings-menu",getContentAnchorEl:null,anchorEl:i,anchorReference:"anchorEl",anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},open:Boolean(i),onClose:c,autoFocus:!1,children:[Object(F.jsx)(U.a,{className:t.menuItem,onClick:function(){c();var t=e.user.screenName;window.open("https://twitter.com/".concat(t),"_blank")},children:"Go to Twitter"}),Object(F.jsx)(U.a,{className:t.menuItem,onClick:function(){c(),e.logout()},children:"Log out"})]})]})}var q=Object(m.a)((function(e){return{toolbar:{height:"1em",padding:"1em 1.5em"},title:{flexGrow:1}}}));function _(e){var t=q(),n=Object(F.jsx)(A,{variant:"contained",color:"secondary",onClick:e.login,children:"Log in"});return Object(F.jsx)(C.a,{position:"relative",children:Object(F.jsxs)(S.a,{className:t.toolbar,children:[Object(F.jsx)(N.a,{variant:"h5",className:t.title,children:"Threadder"}),e.loggedIn?Object(F.jsx)(M,{user:e.user,logout:e.logout}):n]})})}var V=Object(m.a)((function(e){return{toolbarButton:{marginRight:"0.45em",color:e.palette.secondary.dark,"&:hover":{color:e.palette.secondary.main}}}}));function Z(e){var t=V(),n=b()(e.className,t.toolbarButton);return Object(F.jsx)(D.a,Object(E.a)(Object(E.a)({},e),{},{className:n,children:e.children}))}var J=n(97),Y=n.n(J),$=n(99),K=n.n($),Q=n(98),X=n.n(Q),ee=n(209),te=n(96),ne=n(105);function ae(){return e=navigator.userAgent||navigator.vendor||window.opera,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.substr(0,4));var e}n(142),n(143);var re=Object(m.a)((function(e){return{root:{padding:0,marginTop:"0.5em"}}}));function ie(e){var t=re(),n=Object(a.useState)(!1),r=Object(d.a)(n,2),i=r[0],o=r[1];return Object(F.jsxs)("div",{className:t.root,children:[Object(F.jsx)(T.a,{smDown:ae(),children:Object(F.jsx)(ee.a,{onClickAway:function(){o(!1)},children:Object(F.jsxs)("span",{style:{position:"relative"},children:[i&&Object(F.jsx)(ne.a,{set:"twitter",data:te,title:"",emoji:"",showPreview:!1,perLine:8,onSelect:e.pickEmojiHandler}),Object(F.jsx)(Z,{size:"small",onClick:function(){o((function(e){return!e}))},title:"Emoji",children:Object(F.jsx)(Y.a,{})})]})})}),Object(F.jsx)(Z,{size:"small",onClick:e.splitTweetHandler,title:"Split",children:Object(F.jsx)(X.a,{})}),Object(F.jsx)(Z,{size:"small",onClick:e.clearTweetHandler,title:"Clear",children:Object(F.jsx)(K.a,{})})]})}var oe=Object(m.a)((function(e){return{root:{flexFlow:"column nowrap"},fullHeight:{height:"100%"},containerWithShadow:{boxShadow:e.shadows[4]},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},textareaContainer:{display:"flex",flexFlow:"column nowrap",padding:"1.5em",paddingBottom:"0.55em",backgroundColor:e.palette.primary.main},threadTextarea:{fontFamily:"inherit",fontSize:"inherit",resize:"none",width:"100%",padding:"0.5em 0.75em",color:e.palette.primary.contrastText,backgroundColor:e.palette.primary.main,border:0,boxShadow:"inset 0px 0px 5px 0px rgba(0, 0, 0, 0.4)","&:focus":{border:0,outline:0}},statsContainer:{padding:"1em 1.5em",display:"flex",flexFlow:"row nowrap",justifyContent:"space-between",backgroundColor:e.palette.primary.dark},statsText:{color:e.palette.primary.contrastText2},emojiPicker:{position:"absolute"}}})),ce=r.a.forwardRef((function(e,t){var n=oe();return Object(F.jsxs)(I.a,{container:!0,spacing:2,className:b()(n.root,n.fullHeight),children:[Object(F.jsx)(I.a,{item:!0,xs:12,className:b()(n.expandingFlexItem,n.fullHeight),children:Object(F.jsxs)(k.a,{className:b()(n.textareaContainer,n.fullHeight,n.containerWithShadow),children:[Object(F.jsx)("textarea",{className:b()(n.threadTextarea,n.fullHeight),onChange:e.handleTweetInput,onSelect:e.handleCursorPositionChange,placeholder:"Type your tweet here...",value:e.tweetText,ref:t}),Object(F.jsx)(ie,{pickEmojiHandler:e.pickEmojiHandler,splitTweetHandler:e.splitTweetHandler,clearTweetHandler:e.clearTweetHandler})]})}),Object(F.jsx)(I.a,{item:!0,xs:12,className:n.fixedSizeFlexItem,children:Object(F.jsxs)(k.a,{className:b()(n.statsContainer,n.containerWithShadow),children:[Object(F.jsx)(N.a,{variant:"body2",className:n.statsText,children:"Characters: ".concat(e.tweetText.length)}),Object(F.jsx)(N.a,{variant:"body2",className:n.statsText,children:"Tweets: ".concat(e.thread.length)})]})}),Object(F.jsx)(T.a,{mdUp:!0,children:Object(F.jsx)(I.a,{item:!0,xs:12,className:n.fixedSizeFlexItem,children:Object(F.jsx)(A,{variant:"contained",color:"secondary",fullWidth:!0,onClick:e.viewThreadHandler,children:"View thread"})})})]})})),se=n(100),le=n.n(se);function ue(e,t){var n=O.palette.secondary.main,a=e,r=a.slice(0,t.index),i=a.slice(t.index+t[0].length);return r+'<strong style="color: '.concat(n,';">').concat(t[0],"</strong>")+i}function de(e,t){var n,a,r=e,i=(n=t,Array.from(n).sort((function(e,t){return t.index-e.index}))),o=Object(l.a)(i);try{for(o.s();!(a=o.n()).done;){r=ue(r,a.value)}}catch(c){o.e(c)}finally{o.f()}return r}var fe=n(39),me=n(102),he=n.n(me),ge=n(101);n.n(ge).a.config();var be=280,pe="Untitled User",je=Object(m.a)((function(e){return{root:{width:"100%",marginTop:"0.4em",display:"flex",flexFlow:"row nowrap",gap:0,justifyContent:"space-between",alignItems:"center"},imageButton:{margin:0,padding:0,position:"relative",left:"-0.1875rem"},resetFont:{fontFamily:"inherit",fontSize:"inherit"},tweetLength:{margin:0,width:"100%",textAlign:"right",color:e.palette.secondary.main}}}));function xe(e){var t=je(),n=[".png",".jpg",".jpeg",".gif",".webp"],a=function(e){return e.length>4||e.some((function(e){return"image/gif"===e.type}))&&e.length>1},r=function(e){var t=n.map((function(e){return"image/".concat(e.slice(1))}));return e.every((function(e){return t.some((function(t){return e.type===t}))}))},i=function(e){return e.size<5e6||"image/gif"===e.type&&e.size<15e6};return Object(F.jsxs)(I.a,{className:t.root,children:[Object(F.jsx)(I.a,{item:!0,children:Object(F.jsxs)(Z,{className:t.imageButton,size:"small",title:"Add image",disabled:e.addDisabled,onClick:function(e){e.target.parentElement.parentElement.querySelector("input[type='file']").click()},children:[Object(F.jsx)(he.a,{}),Object(F.jsx)("input",{type:"file",accept:n.join(","),multiple:!0,hidden:!0,onChange:function(t){var o=t.target.files;if(0!==o.length){var c=Array.from(o);a(c)?e.setAlertData("error","A maximum of 1 GIF or 4 images can be added"):r(c)?c.every((function(e){return i(e)}))?(e.addImagesHandler(c),t.target.value=""):e.setAlertData("error","You can only upload images that are smaller than 5 MB or GIFs smaller than 15 MB"):e.setAlertData("error","Only the following file types are supported: ".concat(n.join(", ")))}}})]})}),Object(F.jsx)(I.a,{item:!0,children:Object(F.jsx)("p",{className:b()(t.resetFont,t.tweetLength),children:"".concat(e.length,"/").concat(be)})})]})}var ve,we=n(103),Oe=n.n(we),ye=Object(m.a)((function(e){return{root:{position:"relative",width:"100%",minHeight:"100%",maxHeight:"100%"},deleteButton:{padding:0,margin:0,position:"absolute",right:"6px",top:"6px",display:"flex",justifyContent:"center",alignItems:"center"},iconBackground:{position:"absolute",minWidth:"65%",maxWidth:"65%",minHeight:"65%",maxHeight:"65%",backgroundColor:"black",borderRadius:"1em"},buttonIcon:{zIndex:900,scale:1.2},image:{width:"100%",height:"100%",objectFit:"cover"}}}));function ke(e){var t=ye();return Object(F.jsxs)("div",{className:t.root,style:{gridColumn:e.gridColumn,gridRow:e.gridRow},children:[Object(F.jsxs)(Z,{size:"small",className:t.deleteButton,onClick:function(){return e.deleteImageHandler(e.imageIndex)},children:[Object(F.jsx)("span",{className:t.iconBackground}),Object(F.jsx)(Oe.a,{className:t.buttonIcon})]}),Object(F.jsx)("img",{src:e.imageSource,alt:e.altText,className:t.image,onLoad:function(){URL.revokeObjectURL(e.imageSource)}})]})}function Ie(e){return e%2===0}var Te=!1;function Ce(){return Te}function Se(){return new Promise((function(e,t){window.indexedDB||t("Your browser doesn't support IndexedDB. Some features may not work properly.");var n=window.indexedDB.open("threadderDB",1);n.addEventListener("error",(function(e){var n=e.target.error;t("".concat(n.name,": ").concat(n.message))})),n.addEventListener("blocked",(function(){t("Upgrading the database failed. Please close all other tabs with this site open.")})),n.addEventListener("upgradeneeded",(function(e){!function(e){t=e.createObjectStore("images",{keyPath:"tweetIndex"}),n=[{name:"tweetIndex",keyPath:"tweetIndex",params:{unique:!0}}],n.forEach((function(e){t.createIndex(null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.keyPath,null===e||void 0===e?void 0:e.params)}));var t,n}(e.target.result)})),n.addEventListener("success",(function(t){ve=t.target.result,Te=!0,ve.addEventListener("close",(function(){Te=!1})),e("Connected")}))}))}function Ne(e,t,n){return new Promise((function(a,r){ve&&ve instanceof IDBDatabase?function(e){var t=e.map(function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:if(!((n=e.sent)instanceof ArrayBuffer)){e.next=5;break}return e.abrupt("return",{name:t.name,type:t.type,buffer:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return Promise.all(t)}(t).then((function(t){var i=ve.transaction(["images"],"readwrite"),o=i.objectStore("images"),c={tweetIndex:e,buffers:t},s=o[n](c),l=function(){r("Failed to save images to database")};i.addEventListener("abort",(function(){r("Adding images to the database was aborted")})),i.addEventListener("error",l),s.addEventListener("success",(function(){a("All done!")})),s.addEventListener("error",l)})).catch((function(){r("Images are not formatted properly for the database")})):r("Can't save any images because the database isn't open")}))}function Ee(e,t){return Ne(e,t,"add")}function Le(e,t){return Ne(e,t,"put")}function Fe(e,t){return new Promise((function(n,a){if(ve&&ve instanceof IDBDatabase){var r=ve.transaction(["images"],"readwrite"),i=r.objectStore("images")[t](e),o=function(){a("Failed to save images to database")};r.addEventListener("abort",(function(){a("Adding images to the database was aborted")})),r.addEventListener("error",o),i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",o)}else a("Can't save any images because the database isn't open")}))}function He(e){return Fe(e,"delete")}function Ae(e){return new Promise((function(t){Fe(e,"get").then((function(e){t(!!e)})).catch((function(){t(!1)}))}))}function ze(e){return e.map((function(e){return new File([e.buffer],e.name,{type:e.type})}))}var De=Object(m.a)((function(e){return{root:{marginBottom:"1em",flexFlow:"row nowrap","&:last-child":{marginBottom:0}},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},verticalGrid:{display:"flex",flexFlow:"column nowrap"},centerVerticalGridItems:{alignItems:"center"},threadLineContainer:{padding:0},threadLine:{width:"2px",height:"calc(100% + 1.5em)",backgroundColor:e.palette.background.default},tweetContainer:{marginLeft:"1em"},resetFont:{fontFamily:"inherit",fontSize:"inherit"},defaultTextColor:{color:e.palette.primary.contrastText},userName:{fontWeight:"bold"},userHandle:{color:e.palette.primary.contrastText2,marginLeft:"0.5em"},tweetText:{padding:0,margin:0,marginTop:"0.25em",whiteSpace:"pre-wrap",overflowWrap:"break-word"},imageGallery:{width:"100%",height:"16em",minHeight:"16em",maxHeight:"16em",marginTop:"0.4em",borderRadius:"0.5em",display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr 1fr",gridGap:"0.25em"},hiddenOverflow:{overflow:"hidden"}}}));function Be(e){var t=De(),n=e.tweetIndex,r=e.setAlertData,i=Object(a.useState)([]),o=Object(d.a)(i,2),c=o[0],l=o[1],f=Object(a.useState)(!0),m=Object(d.a)(f,2),h=m[0],g=m[1],p=Object(a.useState)(!1),j=Object(d.a)(p,2),x=j[0],v=j[1],w=function(e){var t=[].concat(Object(fe.a)(c.slice(0,e)),Object(fe.a)(c.slice(e+1)));l(t)},O=c.map((function(e,t,n){var a,r,i=(a=t,r=n.length,[Ie(a)?1:2,Ie(a)&&r===a+1||a%2!==0?3:2]),o=Object(d.a)(i,2),c=o[0],s=o[1],l=function(e,t){return[e<2?1:2,e<2&&t<3||e>=2?3:2]}(t,n.length),u=Object(d.a)(l,2),f=u[0],m=u[1],h=e+t+c+s+f+m,g=URL.createObjectURL(e);return Object(F.jsx)(ke,{imageSource:g,altText:"",gridColumn:"".concat(c," / ").concat(s),gridRow:"".concat(f," / ").concat(m),imageIndex:t,deleteImageHandler:w},h)}));return Object(a.useEffect)((function(){var e,t;h&&(e=setInterval((function(){Ce()&&(clearInterval(e),function(e){return new Promise((function(t){Fe(e,"get").then((function(e){t(e?ze(e.buffers):[])})).catch((function(){t([])}))}))}(n).then((function(e){l(e)})),g(!1))}),20),t||(t=setTimeout((function(){clearInterval(e)}),1e4)))}),[h,n]),Object(a.useEffect)((function(){var e=4===c.length||1===c.length&&"image/gif"===c[0].type;v(e)}),[c]),Object(a.useEffect)((function(){Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ce()){e.next=5;break}return e.next=3,Ae(n);case 3:e.sent?c.length>0?Le(n,c).catch((function(e){r("error",e)})):He(n).catch((function(e){r("error",e)})):c.length>0&&Ee(n,c).catch((function(e){r("error",e)}));case 5:case"end":return e.stop()}}),e)})))()}),[n,r,c]),Object(F.jsxs)(I.a,{container:!0,className:t.root,children:[Object(F.jsxs)(I.a,{container:!0,className:b()(t.fixedSizeFlexItem,t.verticalGrid,t.centerVerticalGridItems),children:[Object(F.jsx)(I.a,{item:!0,children:Object(F.jsx)(B.a,{src:e.user.profileImage,alt:"".concat(e.user.name," profile picture")})}),e.threadLine&&Object(F.jsx)(I.a,{item:!0,className:b()(t.expandingFlexItem,t.threadLineContainer),children:Object(F.jsx)("div",{className:t.threadLine})})]}),Object(F.jsxs)(I.a,{container:!0,className:b()(t.expandingFlexItem,t.verticalGrid,t.tweetContainer,t.hiddenOverflow),children:[Object(F.jsxs)(I.a,{item:!0,children:[Object(F.jsx)("span",{className:b()(t.resetFont,t.defaultTextColor,t.userName),children:e.user.name}),Object(F.jsx)("span",{className:b()(t.resetFont,t.userHandle),children:"@".concat(e.user.screenName)})]}),Object(F.jsx)(I.a,{item:!0,children:Object(F.jsx)("p",{className:b()(t.resetFont,t.defaultTextColor,t.tweetText),dangerouslySetInnerHTML:{__html:e.text}})}),Object(F.jsx)(T.a,{xsUp:0===c.length,children:Object(F.jsx)(I.a,{item:!0,className:b()(t.imageGallery,t.hiddenOverflow),children:O})}),Object(F.jsx)(I.a,{item:!0,children:Object(F.jsx)(xe,{length:e.text.length,addDisabled:x,setAlertData:e.setAlertData,addImagesHandler:function(e){var t=[].concat(Object(fe.a)(c),Object(fe.a)(e));l(t)}})})]})]})}var We=Object(m.a)((function(e){return{root:{flexFlow:"column nowrap"},fullHeight:{height:"100%"},containerWithShadow:{boxShadow:e.shadows[4]},expandingFlexItem:{flex:1},fixedSizeFlexItem:{flex:0},autoOverflow:{overflow:"auto"},hiddenOverflow:{overflow:"hidden"},tweetsContainer:{padding:"1.5em",backgroundColor:e.palette.primary.main},buttonRowContainer:{display:"flex",flexFlow:"row nowrap",justifyContent:"space-between",gap:"1em",margin:0,padding:0}}}));function Pe(e){var t=We(),n=e.thread.map((function(t,n,a){var r=le.a.sanitize(t),i=de(r,function(e){var t,n;return"string"===typeof e&&(t=null!==(n=e.matchAll(/@\w+|#\w+[a-zA-Z]+\w+/g))&&void 0!==n?n:[]),t}(r));return Object(F.jsx)(Be,{tweetIndex:n,user:e.user,text:i,threadLine:n+1<a.length,setAlertData:e.setAlertData},n)}));return Object(F.jsxs)(I.a,{container:!0,spacing:2,className:b()(t.root,t.fullHeight,t.hiddenOverflow),children:[Object(F.jsx)(I.a,{item:!0,xs:12,className:b()(t.expandingFlexItem,t.fullHeight,t.hiddenOverflow),children:Object(F.jsx)(k.a,{className:b()(t.tweetsContainer,t.fullHeight,t.containerWithShadow,t.autoOverflow),children:n})}),Object(F.jsx)(I.a,{item:!0,xs:12,className:t.fixedSizeFlexItem,children:Object(F.jsxs)(k.a,{className:b()(t.buttonRowContainer,t.fullHeight),children:[Object(F.jsx)(T.a,{mdUp:!0,children:Object(F.jsx)(A,{variant:"contained",color:"secondary",fullWidth:!0,onClick:e.editThreadHandler,children:"Edit thread"})}),Object(F.jsx)(A,{variant:"contained",color:"secondary",onClick:e.publishHandler,disabled:!n.length>0,fullWidth:!0,children:"Publish thread"})]})})]})}var Re=n(222),Ue=n(212),Ge=n(213),Me=Object(m.a)((function(e){return{dialogText:{color:e.palette.primary.contrastText,textAlign:"center"}}}));function qe(e){var t=Me();return Object(F.jsx)(Re.a,{open:e.open,children:Object(F.jsx)(Ue.a,{children:Object(F.jsx)(Ge.a,{className:t.dialogText,children:e.msg})})})}var _e=n(214),Ve=n(218),Ze=Object(m.a)((function(e){return{root:{position:"absolute",width:"50%",margin:0,zIndex:1e4,left:"25%",top:0}}}));function Je(e){var t=Ze();return Object(F.jsx)(_e.a,{in:e.visible,className:t.root,children:Object(F.jsx)(Ve.a,{severity:e.severity,children:e.msg})})}function Ye(e){return e.replace(/^[ \t]*/,"").replace(/[ \t]*$/,"")}function $e(e){return e.split(/(\n)/).filter((function(e,t,n){return"\n"!==e||"\n"===e&&"\n"!==n[t]}))}function Ke(e){var t,n=[],a=Object(l.a)(e.matchAll(/\svs?\.|\s\w+[a-zA-Z]+(\.)(?=\s*[a-zA-Z]+\w*)|\d+[\s./-]\d+(\.)(?=\s*\W*[a-zA-Z]+\w*\W*)|\s\d+(\.)(?=\s*\W*[a-zA-Z]+\w*\W*)|(\.)$/g));try{for(a.s();!(t=a.n()).done;){var r=t.value;(r[1]||r[2]||r[3]||r[4])&&n.push(r.index+r[0].length)}}catch(i){a.e(i)}finally{a.f()}return 0===n.length?[e]:n.map((function(t,n,a){return 0===n?e.slice(0,t):n+1===a.length&&t+1<e.length?e.slice(t):e.slice(a[n-1],t)})).map((function(e){return Ye(e)}))}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";if(0===e.length)return[];for(var n=[],a=0;a<e.length;a++)if(0!==a){var r=n.length-1,i=n[r],o=e[a];i.length<=70||i.length+o.length<=be?(i+=o.startsWith("\n")?o:"".concat(t).concat(o),n[r]=i):n.push(e[a])}else n.push(e[a]);return n}function Xe(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];if(0!==n){var r=t.length-1,i=tt(t[r]);i.length+a.length+1<=be?t[r]="".concat(i," ").concat(a):t.push(a)}else t.push(a)}return t}function et(e){if(e.length<=be)return e;for(var t=Math.ceil(e.length/277),n=[],a=0;a<t;a++){var r=277*a,i=277*(a+1),o=e.slice(r,i)+"...";n.push(o)}return n}function tt(e){return"..."===e.slice(e.length-3)?e.slice(0,e.length-3):e}function nt(e){var t=e.trim().split("(---)").map((function(e){return e.trim()})).filter((function(e){return""!==e}));if(at(t))return t;var n=t.map((function(e){return e.length<=be?e:function(e){var t=Qe($e(e),"\n");return t.every((function(e){return e.length<=be}))?t:Qe(t.map((function(e){return e.length<=be?e:Ke(e)})).flat().map((function(e){return e.trim()})))}(e)})).flat().map((function(e){return e.trim()}));return at(n)?n:Xe(n.map((function(e){return e.length<=be?e:function(e){if(e.length<=be)return e;var t,n=e.split(" ").filter((function(e){return 0!==e.length})),a="",r=[],i=Object(l.a)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value.trim();o.length>be?(a.length>0&&(r.push("".concat(a,"...")),a=""),r=[].concat(Object(fe.a)(r),Object(fe.a)(et(o)))):0===a.length?a+=o:a.length+o.length+1<277?a+=" ".concat(o):(r.push("".concat(a,"...")),a=o)}}catch(s){i.e(s)}finally{i.f()}a.length>0&&r.push(a);var c=r.length-1;return r[c]=tt(r[c]),r}(e)})).flat().map((function(e){return e.trim()}))).flat().map((function(e){return e.trim()}))}function at(e){return e.every((function(e){return e.length<=be}))}function rt(e){return null!==e&&(t=e,Object.entries(t).length>0)&&function(e,t){var n,a=Object.keys(e),r=Object(l.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!a.includes(i))return!1}}catch(o){r.e(o)}finally{r.f()}return!0}(e,["name","screenName","profileImage"])&&e.name!==pe;var t}var it=n(104),ot=n.n(it);function ct(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return ot()({url:e,method:t,withCredentials:!0,baseURL:"",data:n||{}})}function st(e){return new Promise((function(t,n){var a=e.map((function(e){return function(e){var t=new FormData;return t.append("mediaFile",e),ct("/upload_media","post",t)}(e)}));Promise.all(a).then((function(e){var n=e.map((function(e){return e.data.media_id}));t(n)})).catch((function(e){n(e)}))}))}function lt(e){return ct("/publish_thread","post",{tweets:e})}function ut(e){return"local"===e?localStorage:"session"===e?sessionStorage:void 0}function dt(e,t,n){var a=ut(e);a&&a.setItem(t,JSON.stringify(n))}function ft(e,t){var n=ut(e);if(n)return JSON.parse(n.getItem(t))}var mt=Object(m.a)((function(e){return{root:{height:"100vh",maxHeight:"100vh"},gridContainer:{flexFlow:"column nowrap",height:"100%"},appHeader:{flex:0},appView:Object(f.a)({flex:1},e.breakpoints.up("md"),{display:"flex",flexFlow:"row nowrap",gap:e.spacing(1.5)}),mainArea:{height:"100%"},hiddenOverflow:{overflow:"hidden"}}}));function ht(e){var t=mt(),n={name:pe,screenName:"untitled_user",profileImage:""},r=Object(a.useState)(!1),i=Object(d.a)(r,2),o=i[0],c=i[1],f=Object(a.useState)(!1),m=Object(d.a)(f,2),g=m[0],p=m[1],x=Object(a.useState)("error"),v=Object(d.a)(x,2),w=v[0],C=v[1],S=Object(a.useState)(""),N=Object(d.a)(S,2),E=N[0],L=N[1],H=Object(a.useState)(!1),A=Object(d.a)(H,2),z=A[0],D=A[1],B=Object(a.useState)("This is an empty dialog"),W=Object(d.a)(B,2),P=W[0],R=W[1],U=Object(a.useState)(ft("session","loggedIn")||!1),G=Object(d.a)(U,2),M=G[0],q=G[1],V=Object(a.useState)(ft("session","user")||n),Z=Object(d.a)(V,2),J=Z[0],Y=Z[1],$=Object(a.useState)(ft("session","tweetText")||""),K=Object(d.a)($,2),Q=K[0],X=K[1],ee=Object(a.useState)({start:Q.length,end:Q.length}),te=Object(d.a)(ee,2),ne=te[0],ae=te[1],re=Object(a.useState)([]),ie=Object(d.a)(re,2),oe=ie[0],se=ie[1],le=Object(a.useState)(!0),ue=Object(d.a)(le,2),de=ue[0],fe=ue[1],me=Object(a.createRef)(),he=function(e){var t=function(e,t,n){return[e.slice(0,t.start)+n+e.slice(t.end),t.start+n.length]}(Q,ne,e),n=Object(d.a)(t,2),a=n[0],r=n[1];ae({start:r,end:r}),X(a)},ge=function(){fe(!de)},be=Object(a.useCallback)((function(e,t){p(!0),C(e),L(t)}),[]),je=function(){we("Please wait while we try to log you into your account"),ct("/request_token","get").then((function(e){document.location.href=e.data.redirect})).catch((function(e){console.log(e),be("error","string"===typeof e?e:"Login failed")})).finally(Oe)},xe=Object(a.useCallback)(Object(u.a)(s.a.mark((function e(){var t,n,a,r,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return we("Hold tight while we publish your thread"),t=oe.map((function(e){return{text:e,media:[]}})),e.next=4,new Promise((function(e,t){if(ve&&ve instanceof IDBDatabase){var n=ve.transaction(["images"],"readonly"),a=n.objectStore("images").getAll(),r=function(){t("Failed to retrieve images from the database")};n.addEventListener("error",r),n.addEventListener("abort",(function(){t("Retrieving the images from the database was aborted")})),a.addEventListener("error",r),a.addEventListener("success",(function(t){var n,a=[],r=Object(l.a)(t.target.result);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=i.buffers;delete i.buffers,i.files=ze(o),a.push(i)}}catch(c){r.e(c)}finally{r.f()}e(a)}))}else t("Database is not connected")}));case 4:if(!((n=e.sent)instanceof Array&&n.length>0)){e.next=34;break}a=Object(l.a)(n),e.prev=7,a.s();case 9:if((r=a.n()).done){e.next=26;break}return i=r.value,o=Number(i.tweetIndex),e.prev=12,e.next=15,st(i.files);case 15:c=e.sent,t[o].media=c,e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(12),Oe(),be("error","Thread publishing was cancelled because publishing the images failed"),e.abrupt("return");case 24:e.next=9;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(7),a.e(e.t1);case 31:return e.prev=31,a.f(),e.finish(31);case 34:lt(t).then((function(){be("success","Thread published successfully"),X("")})).catch((function(e){console.log(e),be("error","string"===typeof e?e:"Failed to publish your thread")})).finally(Oe);case 35:case"end":return e.stop()}}),e,null,[[7,28,31,34],[12,19]])}))),[oe,be]),we=function(e){R(e),D(!0)},Oe=function(){D(!1)};return Object(a.useEffect)((function(){o||Se().then((function(){c(!0)})).catch((function(e){be("error",e)}))}),[o,be]),Object(a.useEffect)((function(){ft("session","loginSuccessMessage")?(dt("session","loginSuccessMessage",!1),be("success","You are now logged in")):ft("session","loginFailMessage")&&(dt("session","loginFailMessage",!1),be("error","Login failed"))}),[be]),Object(a.useEffect)((function(){if(""!==document.location.search){var e=j.a.parse(document.location.search);document.location.href="/",rt(e)?(q(!0),Y(e),dt("session","loginSuccessMessage",!0)):dt("session","loginFailMessage",!0)}}),[]),Object(a.useEffect)((function(){""===document.location.search&&oe.length>0&&ft("session","publishAfterLogin")&&(dt("session","publishAfterLogin",!1),xe())}),[oe,xe]),Object(a.useEffect)((function(){me.current&&(me.current.selectionStart=ne.start,me.current.selectionEnd=ne.end)})),Object(a.useEffect)((function(){me.current&&me.current.focus()}),[me]),Object(a.useEffect)((function(){dt("session","loggedIn",M)}),[M]),Object(a.useEffect)((function(){dt("session","user",J)}),[J]),Object(a.useEffect)((function(){var e,t;e=setInterval((function(){Ce()&&(clearInterval(e),0===Q.length&&function(){if(ve&&ve instanceof IDBDatabase){var e=ve.transaction(["images"],"readwrite"),t=e.objectStore("images").clear();e.addEventListener("error",(function(){return"Clear images transaction failed"})),t.addEventListener("error",(function(){return"Clear images request failed"}))}}())}),20),t||(t=setTimeout((function(){clearInterval(e)}),1e4))}),[Q]),Object(a.useEffect)((function(){0===Q.length?se([]):se(nt(Q)),dt("session","tweetText",Q)}),[Q]),Object(a.useEffect)((function(){var e;if(g)return e&&clearTimeout(e),e=setTimeout((function(){p(!1)}),4e3),function(){return clearTimeout(e)}}),[g]),Object(F.jsx)(h.a,{theme:O,children:Object(F.jsxs)(y.a,{children:[Object(F.jsx)(Je,{visible:g,severity:w,msg:E}),Object(F.jsx)(qe,{open:z,msg:P}),Object(F.jsx)(k.a,{className:t.root,children:Object(F.jsxs)(I.a,{container:!0,spacing:3,className:t.gridContainer,children:[Object(F.jsx)(I.a,{item:!0,xs:12,className:t.appHeader,children:Object(F.jsx)(_,{user:J,loggedIn:M,login:je,logout:function(){ct("/logout","get").then((function(){be("success","You are now logged out"),q(!1),Y(n)})).catch((function(e){console.log(e),be("error","string"===typeof e?e:"Logout failed")}))}})}),Object(F.jsxs)(I.a,{item:!0,xs:12,className:b()(t.appView,t.hiddenOverflow),children:[Object(F.jsx)(T.a,{smDown:!de,children:Object(F.jsx)(I.a,{item:!0,xs:12,md:7,className:b()(t.mainArea,t.hiddenOverflow),children:Object(F.jsx)(ce,{tweetText:Q,handleTweetInput:function(e){var t=e.target.value;X(t),ae({start:e.target.selectionStart,end:e.target.selectionEnd})},handleCursorPositionChange:function(e){var t=e.target.selectionStart,n=e.target.selectionEnd;ae({start:t,end:n})},pickEmojiHandler:function(e){he(e.native)},splitTweetHandler:function(){he("\n(---)\n")},clearTweetHandler:function(){X("")},thread:oe,viewThreadHandler:ge,ref:me})})}),Object(F.jsx)(T.a,{smDown:de,children:Object(F.jsx)(I.a,{item:!0,xs:12,md:5,className:b()(t.mainArea,t.hiddenOverflow),children:Object(F.jsx)(Pe,{user:J,thread:oe,editThreadHandler:ge,publishHandler:function(){M?xe():(dt("session","publishAfterLogin",!0),je())},setAlertData:be})})})]})]})})]})})}var gt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function bt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(165);o.a.render(Object(F.jsx)(r.a.StrictMode,{children:Object(F.jsx)(ht,{})}),document.querySelector("#root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");gt?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):bt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):bt(t,e)}))}}()}},[[166,1,2]]]);
//# sourceMappingURL=main.e5968484.chunk.js.map